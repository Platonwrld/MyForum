{% extends 'base.html' %}
{% load static %}
{% load hitcount_tags %}


{% block content %}
<div class="container">
    <!--Navigation-->
    <div class="navigate">
        <span style="    background-color:#292B2E;
        padding: 5px;
        border-radius: 5px;
        margin:4px;"><a href="{% url 'home_page' %}">MyForum - Forums</a> >> <a href="{{ post.cat.all.0.get_absolute_url }}">{{ post.cat.all.0 }}</a> >> <a href="{{ post.get_absolute_url }}">{{ post.title }}</a></span>
    </div>

    <!--Topic Section-->
    <div class="topic-container">
        <!--Original thread-->
        <div class="head">
            <div class="authors">Author</div>
            <div class="content">Topic: {{ post.title }} (Read {% get_hit_count for post %} Times)</div>
        </div>

        <div class="body">
            <div class="authors">
                <div class="username"><a href="">{{ post.user.fullname | title }}</a></div>
                <div>Role</div>
                <img src="{{ post.user.profile_pic.url }}" alt="">
                <div>Posts: <u>45</u></div>
                <div>Points: <u>4586</u></div>
            </div>
            <div class="content">
               {{ post.content | safe }}
                <br>
                <div class="comment">
                    <button onclick="showComment()">Comment</button>
                </div>
            </div>
        </div>
    </div>

           <!--Comment Area-->
           {% if post.closed == True %}
           <div style="background-color:#fff;color:#000;font-weight:bolder;padding:20px;width:100%;"> This Topic Is Closed! </div>
           {% else %}
           {% if request.user.is_authenticated %}
           <form action="." method="post">
               {% csrf_token %}
               <div class="comment-area hide" id="comment-area">
                   <textarea name="comment" id="" placeholder="comment here ... "></textarea>
                   <input type="submit" value="submit" name="comment-form">
               </div>
           </form>
           {% else %}
                <div style="background-color:#fff;color:#000;font-weight:bolder;padding:20px;width:100%;"> You need to <a href="{% url 'signin' %}"><b>login</b></a> to comment or reply.! </div>        
        {% endif %}
    {% endif %}

    <!--Comments Section-->
    {% for comment in post.comments.all %}
    <div class="comments-container">
        <div class="body">
            <div class="authors">
                <div class="username"><a href="">{{ comment.user.fullname | title }}</a></div>
                <div>Role</div>
                <img src="{{ comment.user.profile_pic.url }}" alt="">
                <div>Posts: <u>{{ comment.user.get_numbers_posts }}</u></div>
                <div>Points: <u>{{ comment.user.points }}</u></div>
            </div>
            <div class="content">
                {{ comment.content }}
                <br>
                {% if user.is_authenticated %}
                <div class="comment">
                    <button onclick="showReply('comment{{comment.id}}')">Reply</button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!--Reply Area-->
    <form action="." method="POST">
        {% csrf_token %}
    <div class="comment-area hide" id="comment{{comment.id}}">
        <textarea name="reply" id="" placeholder="reply here ... "></textarea>
        <input type="submit" value="submit" name="reply-form">
        <input type="hidden" name="comment-id" value="{{ comment.id }}">
    </div>
    </form>

    <!-- Reply section -->
    {% for replay in comment.replies.all %}
    <div class="comments-container" style="width: 95%; margin-left: 5%;">
        <div class="body">
            <div class="authors">
                <div class="username"><a href="">{{ replay.user.fullname | title }}</a></div>
                <div>Role</div>
                <img src="{{ replay.user.profile_pic.url }}" alt="">
                <div>Posts: <u>{{ replay.user.get_numbers_posts }}</u></div>
                <div>Points: <u>{{ replay.user.points }}</u></div>
            </div>
            <div class="content">
                {{ replay.content }}
                <br>
            </div>
        </div>
    </div>
    {% endfor %}

    {% endfor %}

    
{% endblock content %}